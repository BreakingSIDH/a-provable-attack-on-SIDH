# A provable attack on SIDH

SageMath implementation following algorithm two of the paper 
*A provable attack on SIDH*. 

This algorithm solves the SSI-T problem in sub-exponential time, 
and does not require 
knowledge of the endomorphism ring of the starting curve of the
protocol.

**SageMath version**: This code was developed using SageMath version 9.6.
Certain isogeny functions require versions 9.5 and above, and it has
been tested to run correctly with version 9.7, the most recent stable
version (at the time of writing).

We note that the code within `richelot_aux.sage` and `speedup.sage`
is based on the work in 
[https://github.com/jack4818/Castryck-Decru-SageMath](https://github.com/jack4818/Castryck-Decru-SageMath).
In particular, `richelot_aux.sage` contains functions which support
the computation of the gluing, Richelot and splitting isogenies and
`speedup.sage` offers some monkey patches which help SageMath performance
for versions running on 9.6 and below.

The file `generate_public_values.sage` is a helper file, which computes
the torsion generators for a given curve, and additionally computes
a SIDH keypair.

The file `attack_aux.sage` is a helper file, which contains methods used
in the implementation of the attack. In particular, it contains functions 
to compute isogenies defined over $F\_{p^2}$ from kernel generators defined 
over some field extension of ${F}\_{p^2}$.

Finally, we note that this package should not be considered as an efficient 
implementation of the attack described in the paper, but rather as a
proof of concept.

## Toy Example

This repository currently has a version of the attack which breaks
the toy example described in the paper.

Precisely, the toy example is an attack against
the SSI-T problem for $p = 2^{19}3^{9}-1$. Given only the tuple 
$(E_A, \phi_A(P_B), \phi_A(Q_B))$ and the public parameters of the protocol,
this code is able to recover Alice's secret $3^9$-isogeny. 
The attack is located within `toy_attack.sage`, which contains detailed
comments which align the code with the steps in algorithm 2.

To perform this attack, following the notation used in the paper, 
we begin with the parameter set $(e,i,j,f)=(2,1,0,1042015)$. 
Note that the cofactor degree $f$ is smooth and factors as:

$$
f = 5 \cdot 13 \cdot 17 \cdot 23 \cdot 41
$$

Every time the algorithm is launched, a random starting curve is sampled via a 
random walk in the supersingular $2$-isogeny graph. 
The public parameters $(P_A, Q_A, P_B, Q_B)$ are generated using the method `.gens()` 
and therefore are not special in any way. These points are then passed to Alice
who generates her secret key and corresponding public information 
$(E_A, \phi_A(P_B), \phi_A(Q_B))$.

Given only the public parameters and Alice's public data, our implementation
of algorithm two allows the recovery of Alice's private key, which is an integer
$x < 3^9$. 

Running the script with `sage toy_attack.sage` an example of the expected output
is given below:

```
User: % sage toy_attack.sage
----------------------------------------------------------------------
The starting curve is
Elliptic Curve defined by y^2 = x^3 + 6*x^2 + (2124165445*i+2704008393)*x + (3138249956*i+8178581861) over Finite Field in i of size 10319560703^2
----------------------------------------------------------------------
The 3^9-torsion group is generated by
(5340533227*i + 4768713068 : 4196824252*i + 8407719329 : 1)
(432800149*i + 7920353304 : 6425451858*i + 5282547553 : 1)
----------------------------------------------------------------------
The 2^19-torsion group is generated by
(6370473511*i + 7229678763 : 3319560175*i + 2299605115 : 1)
(5921952716*i + 1901485508 : 9481228664*i + 426770682 : 1)
----------------------------------------------------------------------
The public key is
Elliptic Curve defined by y^2 = x^3 + 6*x^2 + (8662606653*i+6886051597)*x + (3172339014*i+930111822) over Finite Field in i of size 10319560703^2
(6147674086*i + 3077949566 : 1442244313*i + 4938418885 : 1)
(34034074*i + 1075181166 : 2898106641*i + 418164782 : 1)
----------------------------------------------------------------------
If successful, the attack will recover the secret: 10849
----------------------------------------------------------------------
Generating the public parameters for the attack required 0.37s
----------------------------------------------------------------------
Computing the dual of the cofactor isogeny required 0.86s
----------------------------------------------------------------------
Guessing the last i=1 step(s)
Trying options for eBlb^(-j)-torsion points
Need to check: 8 pairs of points
----------------------------------------------------------------------
Guessing the correct isogeny required 1.79s
----------------------------------------------------------------------
Secret key recovered: 10849
The attack is successful: True
----------------------------------------------------------------------
Altogether, the attack required 2.74s
```
